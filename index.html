<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì—ì½”ì†ŒíŒ… - ëŒ€ì „ê´‘ì—­ì‹œ ë¶„ë¦¬ë°°ì¶œ ê°€ì´ë“œ</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- TensorFlow.js + COCO-SSD -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto',sans-serif;background:#f9fafb;padding-bottom:80px}
    .container{max-width:448px;margin:0 auto;min-height:100vh}
    .header{background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.1);border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:10}
    .header-content{padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
    .back-btn{color:#2563eb;font-weight:500;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:4px}
    .logo{display:flex;align-items:center;gap:8px;font-weight:bold;font-size:18px}
    .location{display:flex;align-items:center;gap:4px;font-size:14px;color:#6b7280;background:none;border:none;cursor:pointer}
    .location:hover{color:#2563eb}
    .main-content{padding:16px}
    .earth-card{background:linear-gradient(135deg,#10b981,#3b82f6);border-radius:16px;padding:24px;color:#fff;margin-bottom:24px}
    .earth-header{display:flex;justify-content:space-between;margin-bottom:16px}
    .earth-level{font-size:20px;font-weight:bold}
    .earth-points{text-align:right}
    .points{font-size:24px;font-weight:bold}
    .streak{font-size:14px;opacity:.9}
    .earth-icon{display:flex;justify-content:center;margin-bottom:16px}
    .earth-emoji{width:96px;height:96px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:48px}
    .progress-bar{width:100%;background:rgba(255,255,255,.2);border-radius:999px;height:8px;margin-bottom:8px;overflow:hidden}
    .progress-fill{height:100%;background:#fff;border-radius:999px;transition:width .5s ease}
    .progress-text{text-align:center;font-size:14px;opacity:.9}
    .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,.1);border:1px solid #e5e7eb;margin-bottom:16px}
    .card-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}
    .card-title{font-weight:600}
    .camera-btn{width:100%;background:linear-gradient(to right,#10b981,#059669);color:#fff;padding:16px;border-radius:12px;font-weight:600;font-size:18px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;box-shadow:0 4px 6px rgba(16,185,129,.3);margin-bottom:16px}
    .camera-btn:hover{background:linear-gradient(to right,#059669,#047857)}
    .quick-menu{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .quick-btn{background:#fff;padding:16px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.1);border:1px solid #e5e7eb;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center}
    .quick-btn:hover{background:#f9fafb}
    .bottom-nav{background:#fff;border-top:1px solid #e5e7eb;position:fixed;bottom:0;left:0;right:0}
    .bottom-nav-content{max-width:448px;margin:0 auto;padding:8px 16px}
    .nav-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}
    .nav-btn{display:flex;flex-direction:column;align-items:center;padding:8px 4px;border-radius:8px;background:none;border:none;cursor:pointer;color:#6b7280}
    .nav-btn.active{color:#10b981;background:#f0fdf4}
    .nav-label{font-size:12px;margin-top:4px}
    .camera-container{text-align:center;margin-bottom:16px}
    .camera-video{width:100%;height:256px;background:#000;border-radius:12px;position:relative;overflow:hidden}
    .camera-placeholder{background:#f3f4f6;border-radius:12px;padding:32px;margin-bottom:16px;display:flex;flex-direction:column;align-items:center;gap:16px;color:#6b7280}
    .demo-section{background:#eff6ff;padding:16px;border-radius:12px;margin-bottom:16px}
    .demo-btn{width:100%;background:#fff;border:1px solid #bfdbfe;padding:12px;border-radius:8px;text-align:left;cursor:pointer;margin-bottom:8px}
    .demo-btn:hover{background:#dbeafe}
    .recognition-result{background:#fff;border-radius:12px;padding:16px;border:2px solid #bbf7d0;margin-top:16px}
    .result-header{display:flex;align-items:center;gap:8px;margin-bottom:12px;color:#166534}
    .confidence-badge{background:#dcfce7;color:#166534;padding:4px 8px;border-radius:4px;font-size:12px}
    .disposal-item{background:#f9fafb;padding:12px;border-radius:8px;margin-bottom:12px}
    .disposal-method{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500;margin-top:4px}
    .method-recycle{background:#dcfce7;color:#166534}
    .method-general{background:#f3f4f6;color:#374151}
    .method-prohibited{background:#fecaca;color:#dc2626}
    .tips-section{background:#fefce8;padding:12px;border-radius:8px;margin-top:16px}
    .tips-content{display:flex;align-items:flex-start;gap:8px;color:#92400e}
    .points-earned{display:flex;align-items:center;justify-content:center;gap:8px;color:#10b981;font-weight:500;margin-top:16px}
    .schedule-grid{display:grid;gap:16px}
    .schedule-item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:8px}
    .schedule-recycle{background:#f0fdf4}
    .schedule-general{background:#f9fafb}
    .schedule-food{background:#fefce8}
    .schedule-info{display:flex;align-items:center;gap:12px}
    .guide-item{background:#fff;border-radius:12px;padding:16px;border:1px solid #e5e7eb;margin-bottom:12px}
    .guide-title{font-weight:600;margin-bottom:8px}
    .guide-plastic{color:#059669}.guide-paper{color:#1d4ed8}.guide-can{color:#6b7280}.guide-prohibited{color:#dc2626}
    .guide-list{font-size:14px;color:#6b7280}
    .guide-list li{margin-bottom:4px}
    .prohibited-section{background:#fef2f2;border:1px solid #fecaca;border-radius:8px;padding:12px;margin-bottom:16px}
    .prohibited-header{color:#dc2626;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:8px}
    .prohibited-list{font-size:14px;color:#7f1d1d}
    .prohibited-list li{margin-bottom:4px}
    .location-selector{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:20;display:flex;align-items:center;justify-content:center;padding:16px}
    .location-modal{background:#fff;border-radius:16px;padding:24px;max-width:400px;width:100%;max-height:80vh;overflow-y:auto}
    .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .close-btn{background:none;border:none;font-size:20px;color:#6b7280;cursor:pointer}
    .close-btn:hover{color:#374151}
    .form-group{margin-bottom:12px}
    .form-label{display:block;font-size:14px;font-weight:500;margin-bottom:8px}
    .form-select{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;background:#fff}
    .form-select:focus{outline:none;border-color:#10b981;box-shadow:0 0 0 2px rgba(16,185,129,.2)}
    .location-info{background:#eff6ff;padding:16px;border-radius:8px;margin:16px 0}
    .location-info h3{font-weight:600;margin-bottom:8px}
    .location-info-list{font-size:14px}
    .location-info-list p{margin-bottom:4px}
    .icon-wrapper{width:24px;height:24px;display:flex;align-items:center;justify-content:center}
    .prohibited-item{background:#fef2f2;padding:8px 12px;border-radius:6px;margin-bottom:6px;border-left:3px solid #dc2626;display:flex;align-items:center;gap:8px;font-size:13px}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    /* =========================
      ì„¤ì • (Cloud Vision ì‚¬ìš©ì‹œ)
    ==========================*/
    // ê³µê°œ ì €ì¥ì†Œì— ì˜¬ë¦¬ì§€ ë§ˆì„¸ìš”.
    const CLOUD_VISION_API_KEY = "AIzaSyBEylMMfX362fajnGcjR2E6vZipmzP9Tuw";
    // í©ì‹œ ë¡œê³  ê°ì§€ í™œì„±í™” ì—¬ë¶€
    const useCloudVision = true;

    /* ===== ì•„ì´ì½˜ (ê°„ë‹¨ SVG) ===== */
    const CameraIcon = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>);
    const MapPin = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>);
    const Calendar = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>);
    const Clock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>);
    const Leaf = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 8c0 7-7 13-7 13s-7-6-7-13a7 7 0 1 1 14 0z"/></svg>);
    const Star = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>);
    const Info = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>);
    const CheckCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/></svg>);
    const AlertTriangle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>);
    const ArrowLeft = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12,19 5,12 12,5"/></svg>);
    const Recycle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5"/><path d="M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775L14.5 4"/><path d="M14 16.5L11.5 14 14 11.5"/><path d="M8.5 9.5 11 7 8.5 4.5"/></svg>);
    const XCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>);
    const ShieldAlert = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>);

    /* ===== ë°ì´í„°ë² ì´ìŠ¤(ë¶„ë¦¬ë°°ì¶œ ì•ˆë‚´) ===== */
    const recognitionDatabase = {
      "ì¹˜í‚¨ë°•ìŠ¤": {
        materials: ["ì¢…ì´ë°•ìŠ¤", "ê¸°ë¦„ë•Œ", "í”Œë¼ìŠ¤í‹± ì†ŒìŠ¤í†µ"],
        disposal: [
          { item:"ì¢…ì´ë°•ìŠ¤ (ê¸°ë¦„ ë¬»ìŒ)", method:"ì¼ë°˜ì“°ë ˆê¸°", reason:"ê¸°ë¦„ë•Œê°€ ë¬»ì–´ ì¬í™œìš© ë¶ˆê°€" },
          { item:"í”Œë¼ìŠ¤í‹± ì†ŒìŠ¤í†µ", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ê¹¨ë—ì´ ì”»ì€ í›„ ë¶„ë¦¬ë°°ì¶œ" },
          { item:"í¬í¬/ë‚˜ì´í”„", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ì¼íšŒìš©í’ˆë„ ê¹¨ë—í•˜ë©´ ì¬í™œìš© ê°€ëŠ¥" }
        ],
        tips:"ê¸°ë¦„ê¸°ê°€ ë§ì´ ë¬»ì€ ì¢…ì´ëŠ” ì¬í™œìš©ì´ ì–´ë ¤ì›Œìš”. ì†ŒìŠ¤í†µì€ ë°˜ë“œì‹œ ê¹¨ë—ì´ ì”»ì–´ì£¼ì„¸ìš”!"
      },
      "ì¤‘êµ­ì§‘ ìš©ê¸°": {
        materials:["í”Œë¼ìŠ¤í‹± ìš©ê¸°","ì•Œë£¨ë¯¸ëŠ„ ëšœê»‘","ë¹„ë‹ë´‰ì§€"],
        disposal:[
          { item:"ê²€ì€ í”Œë¼ìŠ¤í‹± ìš©ê¸°", method:"ì¼ë°˜ì“°ë ˆê¸°", reason:"ê²€ì€ìƒ‰ í”Œë¼ìŠ¤í‹±ì€ ì¬í™œìš© ë¶ˆê°€" },
          { item:"ì•Œë£¨ë¯¸ëŠ„ ëšœê»‘", method:"ìº”ë¥˜ ì¬í™œìš©", reason:"ê¹¨ë—ì´ ì”»ì€ í›„ ë¶„ë¦¬ë°°ì¶œ" },
          { item:"ë¹„ë‹ë´‰ì§€", method:"ë¹„ë‹ë¥˜ ì¬í™œìš©", reason:"ìŒì‹ë¬¼ ì œê±° í›„ ë¶„ë¦¬ë°°ì¶œ" }
        ],
        tips:"ê²€ì€ìƒ‰ í”Œë¼ìŠ¤í‹±ì€ ì¬í™œìš©ì´ ì–´ë ¤ì›Œìš”. íˆ¬ëª…í•˜ê±°ë‚˜ í°ìƒ‰ ìš©ê¸°ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ í™˜ê²½ì— ì¢‹ì•„ìš”!"
      },
      "í”¼ìë°•ìŠ¤": {
        materials:["ì¢…ì´ë°•ìŠ¤","ê¸°ë¦„ë•Œ","ì¹˜ì¦ˆ ë¶€ìŠ¤ëŸ¬ê¸°"],
        disposal:[
          { item:"ê¸°ë¦„ ë¬»ì§€ ì•Šì€ ìœ—ë¶€ë¶„", method:"ì¢…ì´ë¥˜ ì¬í™œìš©", reason:"ê¹¨ë—í•œ ë¶€ë¶„ì€ ì¬í™œìš© ê°€ëŠ¥" },
          { item:"ê¸°ë¦„ ë¬»ì€ ì•„ë«ë¶€ë¶„", method:"ì¼ë°˜ì“°ë ˆê¸°", reason:"ê¸°ë¦„ë•Œë¡œ ì¸í•œ ì¬í™œìš© ë¶ˆê°€" }
        ],
        tips:"í”¼ìë°•ìŠ¤ëŠ” ê¹¨ë—í•œ ë¶€ë¶„ê³¼ ë”ëŸ¬ìš´ ë¶€ë¶„ì„ ë‚˜ëˆ„ì–´ ë°°ì¶œí•˜ì„¸ìš”!"
      },
      "ì½œë¼ë³‘": {
        materials:["í”Œë¼ìŠ¤í‹± ë³‘","ë¼ë²¨","ëšœê»‘"],
        disposal:[
          { item:"PET í”Œë¼ìŠ¤í‹± ë³‘", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"íˆ¬ëª…í•œ PET ì†Œì¬ë¡œ ì¬í™œìš© ê°€ëŠ¥" },
          { item:"í”Œë¼ìŠ¤í‹± ëšœê»‘", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ë¶„ë¦¬í•´ì„œ ë°°ì¶œ" },
          { item:"ë¼ë²¨ì§€", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ë¶™ì¸ ì±„ë¡œ ë°°ì¶œ ê°€ëŠ¥" }
        ],
        tips:"ë‚´ìš©ë¬¼ ì™„ì „íˆ ë¹„ìš°ê³  í—¹êµ° ë’¤ ë°°ì¶œí•˜ì„¸ìš”."
      },
      "ë§¥ì£¼ìº”": {
        materials:["ì•Œë£¨ë¯¸ëŠ„ ìº”"],
        disposal:[{ item:"ì•Œë£¨ë¯¸ëŠ„ ìº”", method:"ìº”ë¥˜ ì¬í™œìš©", reason:"ì•Œë£¨ë¯¸ëŠ„ì€ ë¬´í•œ ì¬í™œìš© ê°€ëŠ¥" }],
        tips:"ë¹„ìš°ê³  í—¹êµ° ë’¤ ë°°ì¶œí•˜ì„¸ìš”."
      },
      "ë¬¼ë³‘": {
        materials:["í”Œë¼ìŠ¤í‹± ë³‘","ë¼ë²¨","ëšœê»‘"],
        disposal:[
          { item:"PET í”Œë¼ìŠ¤í‹± ë³‘", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ëŒ€í‘œì  ê³ í’ˆì§ˆ ì¬í™œìš©" },
          { item:"í”Œë¼ìŠ¤í‹± ëšœê»‘", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ëšœê»‘ë„ í•¨ê»˜ ì¬í™œìš© ê°€ëŠ¥" },
          { item:"ë¼ë²¨ì§€", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ì œê±°í•˜ì§€ ì•Šì•„ë„ OK" }
        ],
        tips:"íˆ¬ëª… PETëŠ” ë¼ë²¨ ì œê±° ì•ˆ í•´ë„ ë©ë‹ˆë‹¤."
      },
      /* í©ì‹œ ë¡œê³  ê°ì§€ ì‹œ ì•ˆë‚´ */
      "í©ì‹œ ìº”/ë³‘": {
        materials:["ì•Œë£¨ë¯¸ëŠ„ ìº” ë˜ëŠ” PET","ë¼ë²¨","ëšœê»‘"],
        disposal:[
          { item:"ì•Œë£¨ë¯¸ëŠ„ ìº” ë˜ëŠ” íˆ¬ëª… PET", method:"ì¬í™œìš©", reason:"ìº”ì€ ìº”ë¥˜, PETëŠ” í”Œë¼ìŠ¤í‹±ë¥˜" },
          { item:"ëšœê»‘", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ë¶„ë¦¬ í›„ ë°°ì¶œ" },
          { item:"ë¼ë²¨", method:"í”Œë¼ìŠ¤í‹± ì¬í™œìš©", reason:"ë¶™ì¸ ì±„ë¡œ ë°°ì¶œ ê°€ëŠ¥(ê°€ëŠ¥í•˜ë©´ ë¶„ë¦¬ ê¶Œì¥)" }
        ],
        tips:"ë‚´ìš©ë¬¼ ì™„ì „íˆ ë¹„ìš°ê³  ê°€ë³ê²Œ í—¹êµ° ë’¤ ë°°ì¶œí•˜ì„¸ìš”. ìº”ì€ ëˆŒëŸ¬ ë¶€í”¼ ì¤„ì´ë©´ ì¢‹ì•„ìš”."
      }
    };

    // COCO í´ë˜ìŠ¤ë¥¼ ìš°ë¦¬ í•­ëª©ìœ¼ë¡œ ë§¤í•‘
    const itemMapping = {
      'bottle': ['ë¬¼ë³‘', 'ì½œë¼ë³‘'],
      'cup': ['ì¤‘êµ­ì§‘ ìš©ê¸°'],
      'pizza': ['í”¼ìë°•ìŠ¤'],
      'can': ['ë§¥ì£¼ìº”']
    };

    const EcoSortApp = () => {
      const [currentView, setCurrentView] = useState('home');
      const [selectedDistrict, setSelectedDistrict] = useState('ì„œêµ¬');
      const [selectedDong, setSelectedDong] = useState('ë„ë§ˆë™');
      const [earthLevel, setEarthLevel] = useState(1);
      const [ecoPoints, setEcoPoints] = useState(120);
      const [dailyStreak, setDailyStreak] = useState(7);

      const [cameraActive, setCameraActive] = useState(false);
      const [recognitionResult, setRecognitionResult] = useState(null);
      const [showLocationSelector, setShowLocationSelector] = useState(false);
      const [model, setModel] = useState(null);
      const [modelLoaded, setModelLoaded] = useState(false);
      const [isDetecting, setIsDetecting] = useState(false);
      const [capturedImage, setCapturedImage] = useState(null); // ì´¬ì˜ë³¸ dataURL
      const [showPreview, setShowPreview] = useState(false);    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ ì—¬ë¶€
      const videoRef = useRef(null);

      /* ---- TFJS ëª¨ë¸ ë¡œë”© ---- */
      useEffect(() => {
        (async () => {
          try {
            if (window.cocoSsd) {
              const m = await window.cocoSsd.load();
              setModel(m);
              setModelLoaded(true);
            } else {
              setModelLoaded(true);
            }
          } catch (e) {
            console.error("ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨:", e);
            setModelLoaded(true);
          }
        })();
      }, []);

      /* ---- ì¹´ë©”ë¼ ì œì–´ (ì‹œì‘/ì •ì§€) ---- */
      const startCamera = async () => {
        setRecognitionResult(null);
        setCapturedImage(null);
        setShowPreview(false);
        setCameraActive(true);
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment', width: { ideal: 640 }, height: { ideal: 480 } }
          });
          if (videoRef.current) {
            videoRef.current.srcObject = stream;
            await videoRef.current.play().catch(()=>{});
          }
        } catch (err) {
          console.error("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:", err);
          alert("ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. (HTTPS í˜ì´ì§€ì—ì„œ ë™ì‘)");
          setCameraActive(false);
        }
      };

      const stopCamera = () => {
        setCameraActive(false);
        if (videoRef.current && videoRef.current.srcObject) {
          videoRef.current.srcObject.getTracks().forEach(t => t.stop());
          videoRef.current.srcObject = null;
        }
      };

      /* ---- ì‚¬ì§„ ì´¬ì˜ â†’ ê°ì§€ ---- */
      const captureAndRecognize = async () => {
        if (!videoRef.current || isDetecting) return;
        setIsDetecting(true);

        try {
          // 1) ìŠ¤ëƒ…ìƒ· ìº¡ì²˜
          const canvas = document.createElement('canvas');
          canvas.width = videoRef.current.videoWidth || 640;
          canvas.height = videoRef.current.videoHeight || 480;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);
          const dataURL = canvas.toDataURL('image/jpeg');
          setCapturedImage(dataURL);
          setShowPreview(true);

          // 2) ì´¬ì˜ ì§í›„ ì¹´ë©”ë¼ ì •ì§€
          stopCamera();

          // 3) Cloud Vision(ì„ íƒ: í©ì‹œ ë¡œê³ ) â†’ ì•„ë‹ˆë©´ TFJSë¡œ ë¶„ì„
          if (useCloudVision && CLOUD_VISION_API_KEY && CLOUD_VISION_API_KEY !== "YOUR_GOOGLE_CLOUD_VISION_API_KEY") {
            const base64Image = dataURL.split(',')[1];
            const res = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${CLOUD_VISION_API_KEY}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                requests: [{
                  image: { content: base64Image },
                  features: [
                    { type: 'LOGO_DETECTION', maxResults: 5 },
                    { type: 'LABEL_DETECTION', maxResults: 5 }
                  ]
                }]
              })
            });
            const json = await res.json();
            const logos = json?.responses?.[0]?.logoAnnotations || [];
            const labels = json?.responses?.[0]?.labelAnnotations || [];
            const hasPepsi =
              logos.some(l => (l.description || '').toLowerCase().includes('pepsi')) ||
              labels.some(l => (l.description || '').toLowerCase().includes('pepsi'));

            if (hasPepsi) {
              showResult("í©ì‹œ ìº”/ë³‘", 0.99);
              setIsDetecting(false);
              return;
            }
            // í©ì‹œê°€ ì•„ë‹ˆë©´ TFJSë¡œ í´ë°±
          }

          if (model && modelLoaded) {
            const preds = await model.detect(canvas);
            if (preds.length) {
              const best = preds.reduce((a,b)=> a.score>b.score?a:b);
              const cls = best.class.toLowerCase();
              let recognizedItem = null;
              for (const [cocoClass, items] of Object.entries(itemMapping)) {
                if (cls.includes(cocoClass) && items && items.length) {
                  recognizedItem = items[Math.floor(Math.random()*items.length)];
                  break;
                }
              }
              if (!recognizedItem) recognizedItem = 'ë¬¼ë³‘';
              showResult(recognizedItem, best.score);
            } else {
              noObjectResult();
            }
          } else {
            alert("ëª¨ë¸ì´ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
          }
        } catch (e) {
          console.error(e);
          alert("ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        } finally {
          setIsDetecting(false);
        }
      };

      const noObjectResult = () => {
        setRecognitionResult({
          item: "ê°ì²´ ë¯¸ê°ì§€",
          confidence: 0,
          disposal: [{ item:"ì¸ì‹ë˜ì§€ ì•Šì€ ë¬¼í’ˆ", method:"ë‹¤ì‹œ ì‹œë„", reason:"ë¬¼ì²´ë¥¼ í™”ë©´ ì¤‘ì•™ì— í¬ê²Œ ë‹´ê³  ë°ì€ ê³³ì—ì„œ ì´¬ì˜í•˜ì„¸ìš”." }],
          tips: "ë Œì¦ˆë¥¼ ë‹¦ê³ , í”ë“¤ë¦¼ ì—†ì´ ì´¬ì˜í•´ë³´ì„¸ìš”."
        });
      };

      const showResult = (itemKey, score=0.9) => {
        const data = recognitionDatabase[itemKey];
        if (!data) return noObjectResult();
        setRecognitionResult({ item: itemKey, confidence: score, ...data });
        setEcoPoints(prev => {
          const np = prev + 10;
          if (np >= earthLevel * 100) setEarthLevel(e => e + 1);
          return np;
        });
      };

      /* ---- ì§€ìì²´ë³„ ê¸ˆì§€ ë¬¼í’ˆ ë°ì´í„°ë² ì´ìŠ¤ ---- */
      const locationDatabase = {
        "ë™êµ¬": { 
          dongs:["ê°€ì–‘ë™","ëŒ€ë³„ë™","ì‚¼ì„±ë™","ì„±ë‚¨ë™","ì†Œì œë™","ì‹ ì¸ë™","ìš©ìš´ë™","ìš©ì „ë™","ì¥ë™","ì¤‘ì•™ë™","íŒì•”ë™","í™ë„ë™","íš¨ë™"],
          schedule:{general:"ì¼~ê¸ˆìš”ì¼ 20ì‹œ ì´í›„", recycle:"í™”, ëª©, í† ìš”ì¼", food:"ì¼~ê¸ˆìš”ì¼ 20ì‹œ ì´í›„"},
          rules:{noDisposal:"í† ìš”ì¼ì€ ì¬í™œìš©í’ˆë§Œ ë°°ì¶œ ê°€ëŠ¥", location:"ì§€ì •ëœ ë°°ì¶œì¥ì†Œ", contact:"ë™êµ¬ì²­ í™˜ê²½ìœ„ìƒê³¼ 042-251-4364"},
          prohibited: [
            "ì „ìì œí’ˆ (TV, ëƒ‰ì¥ê³ , ì—ì–´ì»¨ ë“±) - ëŒ€í˜•íê¸°ë¬¼ ì‹ ê³  í•„ìˆ˜",
            "ì˜ë£Œíê¸°ë¬¼ (ì£¼ì‚¬ê¸°, ì•½í’ˆ ë“±) - ë³‘ì› ë°˜ë‚©",
            "ìœ„í—˜ë¬¼ì§ˆ (ë†ì•½, í˜ì¸íŠ¸, ë°°í„°ë¦¬) - ì „ë¬¸ì—…ì²´ ì²˜ë¦¬",
            "ëŒ€í˜•ê°€êµ¬ - ëŒ€í˜•íê¸°ë¬¼ ì‹ ê³  í›„ ë°°ì¶œ",
            "ê±´ì„¤íê¸°ë¬¼ (íƒ€ì¼, ë²½ëŒ, ì‹œë©˜íŠ¸) - ê±´ì„¤íê¸°ë¬¼ ì²˜ë¦¬ì—…ì²´",
            "ì„ë©´ í•¨ìœ  ë¬¼ì§ˆ - ì „ë¬¸ì—…ì²´ ì˜ë¢° í•„ìˆ˜"
          ],
          specialRules: "ë™êµ¬ëŠ” ì•„íŒŒíŠ¸ ë‹¨ì§€ ë‚´ ë¬´ë‹¨íˆ¬ê¸° ì‹œ ê³¼íƒœë£Œ 50ë§Œì› ë¶€ê³¼"
        },
        "ì¤‘êµ¬": { 
          dongs:["ëŒ€ì‚¬ë™","ëŒ€í¥ë™","ëª©ë™","ë¬¸ì°½ë™","ë¶€ì‚¬ë™","ì‚°ì„±ë™","ì„êµë™","ìš©ë‘ë™","ìœ ì²œë™","ì€í–‰ë™","ì¤‘ì´Œë™","ì¹¨ì‚°ë™","íƒœí‰ë™"],
          schedule:{general:"ì¼~ëª©ìš”ì¼ 18ì‹œ ì´í›„", recycle:"ì›”, ìˆ˜, ê¸ˆìš”ì¼", food:"ì¼~ëª©ìš”ì¼ 18ì‹œ ì´í›„"},
          rules:{noDisposal:"ê¸ˆ, í† , ì¼ìš”ì¼ì€ ì¼ë°˜ì“°ë ˆê¸° ë°°ì¶œ ê¸ˆì§€", location:"ë¬¸ì „ë°°ì¶œ ì›ì¹™", contact:"ì¤‘êµ¬ì²­ ì²­ì†Œí–‰ì •ê³¼ 042-606-6234"},
          prohibited: [
            "ìŒì‹ë¬¼ì“°ë ˆê¸° (ë™ë¬¼ë¼ˆ, ì¡°ê°œê»ì§ˆ, ê²¬ê³¼ë¥˜ ê»ì§ˆ) - ì¼ë°˜ì“°ë ˆê¸°",
            "ì¼íšŒìš© ê¸°ì €ê·€ - ë³„ë„ ë´‰íˆ¬ ì‚¬ìš©",
            "ë°˜ë ¤ë™ë¬¼ ë°°ì„¤ë¬¼ - ì „ìš©ë´‰íˆ¬ ì‚¬ìš© í›„ ì¼ë°˜ì“°ë ˆê¸°",
            "í˜•ê´‘ë“±, LEDì „êµ¬ - ë™ ì£¼ë¯¼ì„¼í„° ìˆ˜ê±°í•¨ ì´ìš©",
            "ìŠ¤í”„ë ˆì´ ìº” (ë‚´ìš©ë¬¼ ì™„ì „ ì œê±°ë˜ì§€ ì•Šì€ ê²ƒ)",
            "ë¼ì´í„°, ë¶€íƒ„ê°€ìŠ¤ - ë‚´ìš©ë¬¼ ì™„ì „ ì œê±° í›„ ìº”ë¥˜"
          ],
          specialRules: "ì¤‘êµ¬ëŠ” ìƒì—…ì§€ì—­ ë°°ì¶œì‹œê°„ ìœ„ë°˜ ì‹œ ê³¼íƒœë£Œ 30ë§Œì›"
        },
        "ì„œêµ¬": { 
          dongs:["ê°€ìˆ˜ì›ë™","ê°€ì¥ë™","ê°ˆë§ˆë™","ê´´ì •ë™","ë‚´ë™","ë„ë§ˆë™","ë‘”ì‚°ë™","ë§Œë…„ë™","ë§¤ë…¸ë™","ë³µìˆ˜ë™","ë³€ë™","ìš©ë¬¸ë™","ìš°ëª…ë™","ì›”í‰ë™","ì¥ì•ˆë™","ì •ë¦¼ë™","í‰ì´Œë™"],
          schedule:{general:"ì¼~ëª©ìš”ì¼ 18ì‹œ ì´í›„", recycle:"í™”, ëª©ìš”ì¼", food:"ì¼~ëª©ìš”ì¼ 18ì‹œ ì´í›„"},
          rules:{noDisposal:"ê¸ˆ, í† ìš”ì¼ì€ ëª¨ë“  ì“°ë ˆê¸° ë°°ì¶œ ê¸ˆì§€", location:"ë‚´ ì§‘ ì• ë¬¸ì „ë°°ì¶œ", contact:"ì„œêµ¬ì²­ ìì›ìˆœí™˜ê³¼ 042-288-3574"},
          prohibited: [
            "ê²€ì€ìƒ‰ ë¹„ë‹ë´‰ì§€ ì‚¬ìš© ê¸ˆì§€ - íˆ¬ëª…/ë°˜íˆ¬ëª…ë§Œ í—ˆìš©",
            "ìŒì‹ë¬¼ì“°ë ˆê¸°ì— ì´ì‘¤ì‹œê°œ, í¬ì¥ì§€ í˜¼í•© ê¸ˆì§€",
            "ì¬í™œìš©í’ˆ ì´ë¬¼ì§ˆ ì œê±° ë¶ˆì™„ì „ ì‹œ ìˆ˜ê±° ê±°ë¶€",
            "ëŒ€í˜•íê¸°ë¬¼ ìŠ¤í‹°ì»¤ ì—†ëŠ” ê°€êµ¬ë¥˜",
            "íì‹ìš©ìœ  (ë”°ë¡œ ëª¨ì•„ì„œ ë™ ì£¼ë¯¼ì„¼í„° ë°°ì¶œ)",
            "íì˜ì•½í’ˆ - ì•½êµ­ ë˜ëŠ” ë³´ê±´ì†Œ ë°˜ë‚©"
          ],
          specialRules: "ì„œêµ¬ëŠ” ì“°ë ˆê¸° ë¶„ë¦¬ë°°ì¶œ ìœ„ë°˜ ì‹œ ê³„ë„ 1íšŒ í›„ ê³¼íƒœë£Œ ë¶€ê³¼"
        },
        "ìœ ì„±êµ¬": { 
          dongs:["ê°‘ë™","ê´€í‰ë™","êµ¬ì„±ë™","ê¶ë™","ë…¸ì€ë™","ìƒëŒ€ë™","ì‹ ì„±ë™","ì–´ì€ë™","ì˜¨ì²œë™","ì›ì‹ í¥ë™","ììš´ë™","ì¥ëŒ€ë™","ì „ë¯¼ë™","ì§€ì¡±ë™","íƒ‘ë¦½ë™","í•™í•˜ë™"],
          schedule:{general:"ì›”~ê¸ˆìš”ì¼ 19ì‹œ ì´í›„", recycle:"ì›”, ìˆ˜, í† ìš”ì¼", food:"ì›”~ê¸ˆìš”ì¼ 19ì‹œ ì´í›„"},
          rules:{noDisposal:"í† ìš”ì¼ì€ ì¬í™œìš©í’ˆë§Œ, ì¼ìš”ì¼ì€ ëª¨ë“  ì“°ë ˆê¸° ë°°ì¶œ ê¸ˆì§€", location:"ê³µë™ì£¼íƒ ì§€ì •ì¥ì†Œ/ë‹¨ë… ë¬¸ì „ë°°ì¶œ", contact:"ìœ ì„±êµ¬ì²­ ìì›ìˆœí™˜ê³¼ 042-611-2174"},
          prohibited: [
            "ì—°êµ¬ì‹¤ íê¸°ë¬¼ (í™”í•™ë¬¼ì§ˆ, ì‹¤í—˜ë„êµ¬) - ì „ë¬¸ì—…ì²´ ì²˜ë¦¬",
            "ëŒ€í•™êµ ê¸°ìˆ™ì‚¬ íê¸°ë¬¼ - ë³„ë„ ìˆ˜ê±°ì²´ê³„ ì´ìš©",
            "ì‚°ì—…íê¸°ë¬¼ (ê³µì¥, ì—°êµ¬ì†Œ) - ì‚¬ì—…ì¥íê¸°ë¬¼ë¡œ ì²˜ë¦¬",
            "íì»´í“¨í„°, íœ´ëŒ€í° - ë¬´ë£Œìˆ˜ê±° ì„œë¹„ìŠ¤ ì´ìš©",
            "ííƒ€ì´ì–´ - íƒ€ì´ì–´ íŒë§¤ì  ë°˜ë‚©",
            "ì„ê³ ë³´ë“œ, ë‹¨ì—´ì¬ - ê±´ì„¤íê¸°ë¬¼ ì²˜ë¦¬"
          ],
          specialRules: "ìœ ì„±êµ¬ëŠ” ëŒ€í•™ê°€ íŠ¹ì„±ìƒ ì›ë£¸ ì“°ë ˆê¸° ë¬´ë‹¨íˆ¬ê¸° ì§‘ì¤‘ ë‹¨ì†"
        },
        "ëŒ€ë•êµ¬": { 
          dongs:["ê°ˆì „ë™","ëŒ€í™”ë™","ë•ì•”ë™","ëª©ìƒë™","ë¹„ë˜ë™","ì„ë´‰ë™","ì†¡ì´Œë™","ì‹ íƒ„ì§„ë™","ì˜¤ì •ë™","ì™€ë™","ìë‚´ë™","ì¥ë™","ì¤‘ë¦¬ë™","í‰ì´Œë™"],
          schedule:{general:"ì›”~ê¸ˆìš”ì¼ 20ì‹œ ì´í›„", recycle:"ì›”, ëª©ìš”ì¼", food:"ì›”~ê¸ˆìš”ì¼ 20ì‹œ ì´í›„"},
          rules:{noDisposal:"í† Â·ì¼ìš”ì¼ì€ ëª¨ë“  ì“°ë ˆê¸° ë°°ì¶œ ê¸ˆì§€", location:"ì§€ì •ëœ ìˆ˜ê±°ì¥ì†Œ", contact:"ëŒ€ë•êµ¬ì²­ í™˜ê²½ê³¼ 042-608-6924"},
          prohibited: [
            "ê³µë‹¨ ì‚°ì—…íê¸°ë¬¼ - ì‚¬ì—…ì¥íê¸°ë¬¼ ì²˜ë¦¬ì—…ì²´ ì´ìš©",
            "ì‹¤í—˜ì‹¤ íì•¡ - ì „ë¬¸ ì²˜ë¦¬ì—…ì²´ ì˜ë¢°",
            "íë†ì•½, ë†ì—…ìš© ë¹„ë‹ - ë†í˜‘ ìˆ˜ê±°í•¨ ì´ìš©",
            "ì„ë©´ ìŠ¬ë ˆì´íŠ¸ - ì„ë©´ ì „ë¬¸ ì² ê±°ì—…ì²´",
            "íì˜¤ì¼ (ìë™ì°¨, ê¸°ê³„) - ì •ë¹„ì†Œ ë°˜ë‚©",
            "íë°°í„°ë¦¬ (ìë™ì°¨ìš©) - ìë™ì°¨ ì •ë¹„ì—…ì†Œ"
          ],
          specialRules: "ëŒ€ë•êµ¬ëŠ” ì—°êµ¬ë‹¨ì§€ íŠ¹ì„±ìƒ í™”í•™íê¸°ë¬¼ ë¬´ë‹¨íˆ¬ê¸° ì—„ì¤‘ ì²˜ë²Œ"
        }
      };

      const getCurrentLocationData = () => locationDatabase[selectedDistrict];

      const getTodayDisposal = () => {
        const day = new Date().getDay(); // 0=ì¼
        if (selectedDistrict === "ì„œêµ¬") {
          if (day === 5 || day === 6) return { canDispose:false, message:"ê¸ˆ, í† ìš”ì¼ì€ ëª¨ë“  ì“°ë ˆê¸° ë°°ì¶œ ê¸ˆì§€ì¼ì…ë‹ˆë‹¤" };
          const canRecycle = (day === 2 || day === 4);
          return { canDispose:true, message: canRecycle ? "ì˜¤ëŠ˜ì€ ì¬í™œìš©í’ˆ ë°°ì¶œ ê°€ëŠ¥ì¼ì…ë‹ˆë‹¤!" : "ì˜¤ëŠ˜ì€ ì¼ë°˜/ìŒì‹ë¬¼ì“°ë ˆê¸° ë°°ì¶œ ê°€ëŠ¥ì¼ì…ë‹ˆë‹¤" };
        }
        return { canDispose:true, message:"ë°°ì¶œ ê°€ëŠ¥ì¼ì…ë‹ˆë‹¤" };
      };

      const renderHeader = () => (
        <div className="header">
          <div className="header-content">
            {currentView !== 'home' && <button onClick={()=>setCurrentView('home')} className="back-btn"><ArrowLeft/>ë’¤ë¡œ</button>}
            <div className="logo"><Leaf/>ì—ì½”ì†ŒíŒ…</div>
            <button onClick={()=>setShowLocationSelector(true)} className="location"><MapPin/>{selectedDistrict} {selectedDong}</button>
          </div>
        </div>
      );

      const renderLocationSelector = () => (
        <div className="location-selector">
          <div className="location-modal">
            <div className="modal-header">
              <h2 style={{fontSize:'20px',fontWeight:'bold'}}>ì§€ì—­ ì„¤ì •</h2>
              <button onClick={()=>setShowLocationSelector(false)} className="close-btn">âœ•</button>
            </div>

            <div className="form-group">
              <label className="form-label">êµ¬ ì„ íƒ</label>
              <select className="form-select" value={selectedDistrict}
                onChange={(e)=>{ setSelectedDistrict(e.target.value); setSelectedDong(locationDatabase[e.target.value].dongs[0]); }}>
                {Object.keys(locationDatabase).map(d=><option key={d} value={d}>{d}</option>)}
              </select>
            </div>

            <div className="form-group">
              <label className="form-label">ë™ ì„ íƒ</label>
              <select className="form-select" value={selectedDong} onChange={(e)=>setSelectedDong(e.target.value)}>
                {locationDatabase[selectedDistrict].dongs.map(d=><option key={d} value={d}>{d}</option>)}
              </select>
            </div>

            <div className="location-info">
              <h3>ì„ íƒëœ ì§€ì—­ì˜ ë°°ì¶œ ì •ë³´</h3>
              <div className="location-info-list">
                <p>â€¢ ì¼ë°˜ì“°ë ˆê¸°: {getCurrentLocationData().schedule.general}</p>
                <p>â€¢ ì¬í™œìš©í’ˆ: {getCurrentLocationData().schedule.recycle}</p>
                <p>â€¢ ìŒì‹ë¬¼ì“°ë ˆê¸°: {getCurrentLocationData().schedule.food}</p>
                <p>â€¢ íŠ¹ì´ì‚¬í•­: {getCurrentLocationData().rules.noDisposal}</p>
                <p>â€¢ ë°°ì¶œì¥ì†Œ: {getCurrentLocationData().rules.location}</p>
                <p>â€¢ ë¬¸ì˜ì „í™”: {getCurrentLocationData().rules.contact}</p>
              </div>
            </div>

            {/* ê¸ˆì§€ ë¬¼í’ˆ ì„¹ì…˜ */}
            <div className="prohibited-section">
              <div className="prohibited-header">
                <ShieldAlert style={{width:'20px',height:'20px'}}/>
                ë°°ì¶œ ê¸ˆì§€ ë¬¼í’ˆ
              </div>
              <div className="prohibited-list">
                {getCurrentLocationData().prohibited.slice(0, 3).map((item, index) => (
                  <div key={index} className="prohibited-item">
                    <XCircle style={{width:'16px',height:'16px',color:'#dc2626',flexShrink:0}}/>
                    {item}
                  </div>
                ))}
                <p style={{fontSize:'12px',color:'#7f1d1d',marginTop:'8px'}}>
                  {getCurrentLocationData().specialRules}
                </p>
              </div>
            </div>

            <button className="camera-btn" onClick={()=>setShowLocationSelector(false)}>ì™„ë£Œ</button>
          </div>
        </div>
      );

      const renderHomeView = () => {
        const disposalInfo = getTodayDisposal();
        const progress = (ecoPoints % (earthLevel * 100)) / (earthLevel * 100) * 100;
        return (
          <div className="main-content">
            <div className="earth-card">
              <div className="earth-header">
                <div>
                  <div className="earth-level">ë ˆë²¨ {earthLevel}</div>
                  <div style={{fontSize:'14px',opacity:.9}}>ì§€êµ¬ì§€í‚´ì´</div>
                </div>
                <div className="earth-points">
                  <div className="points">{ecoPoints}</div>
                  <div className="streak">{dailyStreak}ì¼ ì—°ì†</div>
                </div>
              </div>
              <div className="earth-icon"><div className="earth-emoji">ğŸŒ</div></div>
              <div className="progress-bar"><div className="progress-fill" style={{width:`${progress}%`}}/></div>
              <div className="progress-text">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ {(earthLevel*100)-(ecoPoints%(earthLevel*100))}ì </div>
            </div>

            <div className="card">
              <div className="card-header"><Calendar/><span className="card-title">ì˜¤ëŠ˜ ë°°ì¶œ ì •ë³´</span></div>
              <div className={`disposal-info ${disposalInfo.canDispose ? 'disposal-allowed' : 'disposal-forbidden'}`}>
                <div style={{display:'flex',alignItems:'center',gap:'8px'}}>
                  {disposalInfo.canDispose ? <CheckCircle/> : <AlertTriangle/>}
                  <span>{disposalInfo.message}</span>
                </div>
              </div>
            </div>

            <button className="camera-btn" onClick={()=>setCurrentView('camera')}>
              <CameraIcon/> ë°°ë‹¬ìš©ê¸° ë¶„ë¦¬ë°°ì¶œ ê°€ì´ë“œ
            </button>

            <div className="quick-menu">
              <div className="quick-btn" onClick={()=>setCurrentView('camera')}><CameraIcon/><span>AI ì¸ì‹</span></div>
              <div className="quick-btn" onClick={()=>setCurrentView('schedule')}><Clock/><span>ë°°ì¶œ ì¼ì •</span></div>
              <div className="quick-btn" onClick={()=>setCurrentView('guide')}><Info/><span>ë¶„ë¦¬ë°°ì¶œ ê°€ì´ë“œ</span></div>
              <div className="quick-btn" onClick={()=>setCurrentView('prohibited')}><ShieldAlert/><span>ê¸ˆì§€ ë¬¼í’ˆ</span></div>
            </div>
          </div>
        );
      };

      const renderCameraView = () => (
        <div className="main-content">
          <div className="camera-container">
            {showPreview && capturedImage ? (
              <div className="camera-video">
                <img src={capturedImage} alt="ì´¬ì˜ ì´ë¯¸ì§€" style={{width:'100%',height:'100%',objectFit:'cover',borderRadius:'12px'}}/>
              </div>
            ) : cameraActive ? (
              <div className="camera-video">
                <video ref={videoRef} autoPlay playsInline style={{width:'100%',height:'100%',objectFit:'cover'}}/>
              </div>
            ) : (
              <div className="camera-placeholder">
                <CameraIcon/>
                <p>ì´¬ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì°ê³  ì¸ì‹í•´ë³´ì„¸ìš”</p>
              </div>
            )}

            {!cameraActive && !showPreview && (
              <button className="camera-btn" onClick={startCamera}>ì¹´ë©”ë¼ ì‹œì‘</button>
            )}

            {cameraActive && !showPreview && (
              <>
                <button className="camera-btn" onClick={captureAndRecognize} disabled={!modelLoaded || isDetecting}>
                  {isDetecting ? "ì¸ì‹ ì¤‘..." : "ì´¬ì˜í•˜ì—¬ ì¸ì‹"}
                </button>
                <button className="quick-btn" style={{width:'100%',marginTop:'8px'}} onClick={stopCamera}>ì¹´ë©”ë¼ ì¢…ë£Œ</button>
              </>
            )}

            {showPreview && (
              <button className="camera-btn" onClick={startCamera} style={{marginTop:'12px'}}>ë‹¤ì‹œ ì´¬ì˜</button>
            )}
          </div>

          <div className="demo-section">
            <h3 style={{marginBottom:'12px',fontSize:'16px',fontWeight:'600'}}>ğŸ¯ ë°ëª¨ ì²´í—˜í•˜ê¸°</h3>
            <p style={{marginBottom:'12px',fontSize:'14px',color:'#6b7280'}}>ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì¸ì‹ ê²°ê³¼ë¥¼ ì²´í—˜í•´ë³´ì„¸ìš”</p>
            <button className="demo-btn" onClick={()=>showResult('ì¹˜í‚¨ë°•ìŠ¤',0.92)}>ğŸ— ì¹˜í‚¨ë°•ìŠ¤ ì¸ì‹í•˜ê¸°</button>
            <button className="demo-btn" onClick={()=>showResult('ì¤‘êµ­ì§‘ ìš©ê¸°',0.94)}>ğŸ¥¡ ì¤‘êµ­ì§‘ ë°°ë‹¬ìš©ê¸° ì¸ì‹í•˜ê¸°</button>
            <button className="demo-btn" onClick={()=>showResult('í”¼ìë°•ìŠ¤',0.93)}>ğŸ• í”¼ìë°•ìŠ¤ ì¸ì‹í•˜ê¸°</button>
            <button className="demo-btn" onClick={()=>showResult('í©ì‹œ ìº”/ë³‘',0.99)}>ğŸ¥¤ (í…ŒìŠ¤íŠ¸) í©ì‹œ ì¸ì‹í•˜ê¸°</button>
          </div>

          {recognitionResult && (
            <div className="recognition-result">
              <div className="result-header">
                <CheckCircle/>
                <span style={{fontWeight:'600'}}>"{recognitionResult.item}" ì¸ì‹ ì™„ë£Œ</span>
                <span className="confidence-badge">{Math.round(recognitionResult.confidence*100)}% ì •í™•ë„</span>
              </div>

              <div style={{marginBottom:'12px'}}>
                <h4 style={{fontSize:'14px',fontWeight:'600',marginBottom:'8px'}}>ë¶„ë¦¬ë°°ì¶œ ë°©ë²•:</h4>
                {recognitionResult.disposal.map((d,i)=>(
                  <div key={i} className="disposal-item">
                    <div style={{fontWeight:'500',marginBottom:'4px'}}>{d.item}</div>
                    <div className={`disposal-method ${d.method.includes('ì¬í™œìš©')?'method-recycle':d.method.includes('ê¸ˆì§€')?'method-prohibited':'method-general'}`}>{d.method}</div>
                    <div style={{fontSize:'12px',color:'#6b7280',marginTop:'4px'}}>{d.reason}</div>
                  </div>
                ))}
              </div>

              <div className="tips-section">
                <div className="tips-content">
                  <Info style={{width:'16px',height:'16px',flexShrink:0}}/>
                  <span style={{fontSize:'14px'}}>{recognitionResult.tips}</span>
                </div>
              </div>

              <div className="points-earned"><Star/><span>+10 ì—ì½”í¬ì¸íŠ¸ íšë“!</span></div>
            </div>
          )}
        </div>
      );

      const renderScheduleView = () => {
        const locationData = getCurrentLocationData();
        return (
          <div className="main-content">
            <div className="card">
              <div className="card-header"><Calendar/><span className="card-title">{selectedDistrict} {selectedDong} ë°°ì¶œ ì¼ì •</span></div>
              <div className="schedule-grid">
                <div className="schedule-item schedule-general">
                  <div className="schedule-info">
                    <div><div style={{fontWeight:'600'}}>ì¼ë°˜ì“°ë ˆê¸°</div><div style={{fontSize:'14px',color:'#6b7280'}}>{locationData.schedule.general}</div></div>
                  </div>
                </div>
                <div className="schedule-item schedule-recycle">
                  <div className="schedule-info">
                    <div><div style={{fontWeight:'600'}}>ì¬í™œìš©í’ˆ</div><div style={{fontSize:'14px',color:'#6b7280'}}>{locationData.schedule.recycle}</div></div>
                  </div>
                </div>
                <div className="schedule-item schedule-food">
                  <div className="schedule-info">
                    <div><div style={{fontWeight:'600'}}>ìŒì‹ë¬¼ì“°ë ˆê¸°</div><div style={{fontSize:'14px',color:'#6b7280'}}>{locationData.schedule.food}</div></div>
                  </div>
                </div>
              </div>

              <div style={{background:'#fef2f2',padding:'12px',borderRadius:'8px',marginTop:'16px'}}>
                <div style={{display:'flex',alignItems:'center',gap:'8px',color:'#dc2626'}}><AlertTriangle style={{width:'16px',height:'16px'}}/><span style={{fontSize:'14px',fontWeight:'500'}}>{locationData.rules.noDisposal}</span></div>
              </div>
              <div style={{background:'#eff6ff',padding:'12px',borderRadius:'8px',marginTop:'8px'}}>
                <div style={{display:'flex',alignItems:'center',gap:'8px',color:'#1d4ed8'}}><Info style={{width:'16px',height:'16px'}}/>
                  <div style={{fontSize:'14px'}}>
                    <div>ë°°ì¶œì¥ì†Œ: {locationData.rules.location}</div>
                    <div>ë¬¸ì˜ì „í™”: {locationData.rules.contact}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const renderProhibitedView = () => {
        const locationData = getCurrentLocationData();
        return (
          <div className="main-content">
            <div className="card">
              <div className="card-header">
                <ShieldAlert/>
                <span className="card-title">{selectedDistrict} ë°°ì¶œ ê¸ˆì§€ ë¬¼í’ˆ</span>
              </div>
              
              <div className="prohibited-section">
                <div className="prohibited-header">
                  <XCircle style={{width:'20px',height:'20px'}}/>
                  ì ˆëŒ€ ì¼ë°˜ì“°ë ˆê¸°ë¡œ ë°°ì¶œ ê¸ˆì§€
                </div>
                <div className="prohibited-list">
                  {locationData.prohibited.map((item, index) => (
                    <div key={index} className="prohibited-item">
                      <XCircle style={{width:'16px',height:'16px',color:'#dc2626',flexShrink:0}}/>
                      <span>{item}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div style={{background:'#fffbeb',padding:'16px',borderRadius:'8px',marginTop:'16px'}}>
                <div style={{display:'flex',alignItems:'flex-start',gap:'8px',color:'#92400e'}}>
                  <AlertTriangle style={{width:'20px',height:'20px',flexShrink:0}}/>
                  <div>
                    <div style={{fontWeight:'600',marginBottom:'4px'}}>íŠ¹ë³„ ì£¼ì˜ì‚¬í•­</div>
                    <p style={{fontSize:'14px'}}>{locationData.specialRules}</p>
                  </div>
                </div>
              </div>

              <div style={{background:'#f0fdf4',padding:'16px',borderRadius:'8px',marginTop:'16px'}}>
                <div style={{display:'flex',alignItems:'flex-start',gap:'8px',color:'#166534'}}>
                  <Info style={{width:'20px',height:'20px',flexShrink:0}}/>
                  <div>
                    <div style={{fontWeight:'600',marginBottom:'4px'}}>ì˜¬ë°”ë¥¸ ì²˜ë¦¬ ë°©ë²•</div>
                    <p style={{fontSize:'14px'}}>
                      â€¢ ëŒ€í˜•íê¸°ë¬¼: ê° êµ¬ì²­ í™ˆí˜ì´ì§€ì—ì„œ ì˜¨ë¼ì¸ ì‹ ê³ <br/>
                      â€¢ ì „ìì œí’ˆ: ë¬´ë£Œ ìˆ˜ê±° ì„œë¹„ìŠ¤ ì´ìš©<br/>
                      â€¢ ìœ„í—˜ë¬¼ì§ˆ: ì „ë¬¸ ì²˜ë¦¬ì—…ì²´ ë¬¸ì˜<br/>
                      â€¢ ì˜ë£Œíê¸°ë¬¼: ë³‘ì›ì´ë‚˜ ì•½êµ­ ë°˜ë‚©<br/>
                      â€¢ ê±´ì„¤íê¸°ë¬¼: ê±´ì„¤íê¸°ë¬¼ ì²˜ë¦¬ì—…ì²´ ì´ìš©
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const renderGuideView = () => (
        <div className="main-content">
          <div className="guide-item">
            <div className="guide-title guide-plastic"><Recycle style={{width:'20px',height:'20px',display:'inline',marginRight:'8px'}}/>í”Œë¼ìŠ¤í‹±ë¥˜</div>
            <ul className="guide-list">
              <li>â€¢ ìŒë£Œìˆ˜ë³‘, ìƒìˆ˜ë³‘ (ëšœê»‘ ë¶„ë¦¬)</li>
              <li>â€¢ ìƒ´í‘¸/ì„¸ì œ ìš©ê¸° (ë‚´ìš©ë¬¼ ì™„ì „ ì œê±°)</li>
              <li>â€¢ íˆ¬ëª… ì¼íšŒìš© ìš©ê¸°</li>
              <li>âŒ ê²€ì€ìƒ‰ í”Œë¼ìŠ¤í‹±, ìŠ¤í‹°ë¡œí¼</li>
            </ul>
          </div>
          <div className="guide-item">
            <div className="guide-title guide-paper">ğŸ“„ ì¢…ì´ë¥˜</div>
            <ul className="guide-list">
              <li>â€¢ ì‹ ë¬¸/ì±…/ì¡ì§€</li>
              <li>â€¢ ê³¨íŒì§€ (í…Œì´í”„Â·ì² í•€ ì œê±°)</li>
              <li>â€¢ ìš°ìœ íŒ©/ìŒë£ŒíŒ© (í—¹êµ° ë’¤)</li>
              <li>âŒ ê¸°ë¦„ ë¬»ì€ ì¢…ì´, ì½”íŒ…ì§€</li>
            </ul>
          </div>
          <div className="guide-item">
            <div className="guide-title guide-can">ğŸ¥« ìº”ë¥˜</div>
            <ul className="guide-list">
              <li>â€¢ ìŒë£ŒÂ·ë§¥ì£¼ìº”</li>
              <li>â€¢ ì°¸ì¹˜Â·ê³¼ì¼ìº” (ë‚´ìš©ë¬¼ ì œê±°)</li>
              <li>â€¢ ì•Œë£¨ë¯¸ëŠ„ í˜¸ì¼</li>
              <li>âŒ í˜ì¸íŠ¸í†µ, ì‚´ì¶©ì œí†µ</li>
            </ul>
          </div>

          {/* ì§€ì—­ë³„ íŠ¹ë³„ ì•ˆë‚´ */}
          <div className="guide-item">
            <div className="guide-title guide-prohibited">
              <XCircle style={{width:'20px',height:'20px',display:'inline',marginRight:'8px'}}/>
              {selectedDistrict} íŠ¹ë³„ ì£¼ì˜ì‚¬í•­
            </div>
            <ul className="guide-list">
              {getCurrentLocationData().prohibited.slice(0, 4).map((item, index) => (
                <li key={index} style={{color:'#dc2626'}}>âŒ {item}</li>
              ))}
            </ul>
            <div style={{marginTop:'12px',padding:'8px',background:'#fef2f2',borderRadius:'6px',fontSize:'13px',color:'#7f1d1d'}}>
              ğŸ’¡ ë” ìì„¸í•œ ê¸ˆì§€ë¬¼í’ˆì€ 'ê¸ˆì§€ ë¬¼í’ˆ' íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”
            </div>
          </div>
        </div>
      );

      const renderBottomNav = () => (
        <div className="bottom-nav">
          <div className="bottom-nav-content">
            <div className="nav-grid">
              <button className={`nav-btn ${currentView==='home'?'active':''}`} onClick={()=>setCurrentView('home')}>
                <div className="icon-wrapper"><Leaf/></div><span className="nav-label">í™ˆ</span>
              </button>
              <button className={`nav-btn ${currentView==='camera'?'active':''}`} onClick={()=>setCurrentView('camera')}>
                <div className="icon-wrapper"><CameraIcon/></div><span className="nav-label">ì¸ì‹</span>
              </button>
              <button className={`nav-btn ${currentView==='schedule'?'active':''}`} onClick={()=>setCurrentView('schedule')}>
                <div className="icon-wrapper"><Calendar/></div><span className="nav-label">ì¼ì •</span>
              </button>
              <button className={`nav-btn ${currentView==='guide'?'active':''}`} onClick={()=>setCurrentView('guide')}>
                <div className="icon-wrapper"><Info/></div><span className="nav-label">ê°€ì´ë“œ</span>
              </button>
              <button className={`nav-btn ${currentView==='prohibited'?'active':''}`} onClick={()=>setCurrentView('prohibited')}>
                <div className="icon-wrapper"><ShieldAlert/></div><span className="nav-label">ê¸ˆì§€ë¬¼í’ˆ</span>
              </button>
            </div>
          </div>
        </div>
      );

      const renderCurrentView = () => {
        switch (currentView) {
          case 'camera': return renderCameraView();
          case 'schedule': return renderScheduleView();
          case 'guide': return renderGuideView();
          case 'prohibited': return renderProhibitedView();
          default: return renderHomeView();
        }
      };

      return (
        <div className="container">
          {renderHeader()}
          {renderCurrentView()}
          {renderBottomNav()}
          {showLocationSelector && renderLocationSelector()}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<EcoSortApp />);
  </script>
</body>
</html>